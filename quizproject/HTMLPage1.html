<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>QUIZ</title>
    <link href="https://unpkg.com/tabulator-tables@4.8.1/dist/css/tabulator.min.css" rel="stylesheet">
    <script type="text/javascript" src="https://unpkg.com/tabulator-tables@4.8.1/dist/js/tabulator.min.js"></script>
</head>
<body>
    <h1> End of quiz </h1>
    <h1> Results </h1>
    <button onclick="tab()">View Result</button>
    <p id="demo"></p>
    <div id="demo1"></div>
    <div id="example-table"></div>
    <script type="text/javascript">
        var name = localStorage.getItem("firstname");
        document.getElementById("demo").innerHTML = name;
        console.log(name);
        const n = { "username": name }
        fetch('http://localhost:3000/count', {
            method: 'POST',
            body: JSON.stringify(n),
            headers: {
                'Content-type': 'application/json; charset=UTF-8'
            }
        })
            .then(response => response.json())
            .then(json => {
                //json.totalscore
                console.log(json.correct);
                console.log(json.totalscore);
                ////c = json.correct;
                ////t = json.totalscore;
                document.getElementById("demo1").innerHTML = json.correct + '/' + json.totalscore;
            })
        function tab() {
            const n = { "username": name }
            fetch('http://localhost:3000/viewtable', {
                method: 'POST',
                body: JSON.stringify(n),
                headers: {
                    'Content-type': 'application/json; charset=UTF-8'
                }
            })
                .then(response => response.json())
                .then(json => {
                    console.log(json.data);
                    var table = new Tabulator("#example-table", {
                        height: 220,
                        data: json.data,           //load row data from array
                        tooltips: true,
                        layout: "fitColumns",      //fit columns to width of table
                        addRowPos: "top",          //when adding a new row, add it to the top of the table
                        history: true,             //allow undo and redo actions on the table
                        pagination: "local",       //paginate the data
                        paginationSize: 10,         //allow 7 rows per page of data
                        columns: [                 //define the table columns
                            { title: "Question", field: "question", width: 350, hozAlign: "left", sorter: "string", },
                            { title: "Correct Answer", field: "answer", hozAlign: "left", width: 200, sorter: "string", },
                            { title: "Selected Answer", field: "selectedanswer", hozAlign: "left", width: 200, sorter: "string", },
                            {
                                title: "Status", field: "status", hozAlign: "center", width: 190, sorter: "string", formatter: function (cell, formatterParams) {
                                    //cell - the cell component
                                    //formatterParams - parameters set for the column
                                    var value = cell.getValue();
                                    if (value === "incorrect") {
                                        //cell.getElement().css({ "background-color": "red" });
                                        cell.getElement().style.backgroundColor = "red"
                                    }
                                    else {
                                        cell.getElement().style.backgroundColor = "green"
                                    }
                                    return value;
                                }
                                    //var data = cell.getValue()
                                    //if (data == "incorrect") {
                                    //    return "<span style='color:red; font-weight:bold;'>" + value + "</span>";
                                    //    var element = cell.getValue();
                                    //    console.log(element)
                                    //    cell.getElement().innerHTML = element
                                    //    cell.getElement().style.backgroundColor = "red"
                                    //}
                                    //else {
                                    //    return "<span style='color:green; font-weight:bold;'>" + value + "</span>";
                                    //    cell.getElement().style.backgroundColor = "green"
                                    //}
                            }
                        ]
                    });
                })
        }
    </script>
</body>
</html>