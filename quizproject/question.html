<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>Question</title>
    <style>
        /* Style the buttons */
        .btn {
            border: none;
            outline: none;
            padding: 10px 16px;
            background-color: #f1f1f1;
            cursor: pointer;
            font-size: 18px;
        }

            /* Style the active class, and buttons on mouse-over */
            .active, .btn:hover {
                background-color: #666;
                color: white;
            }
    </style>
    <!--<script  type="text/javascript" >
       
        window.addEventListener('beforeunload', (event) => {

            console.log("red")
            console.log("BEFORE")
            //navigator.sendBeacon("http://www.google.it");
            return "stop"
            // Cancel the event as stated by the standard.
            event.preventDefault();
            // Chrome requires returnValue to be set.
            event.returnValue = '';
        });

    </script>-->
</head>
<body onload="questions()">
    <form action="" onsubmit="return false">
        <label for="question" id="question">question</label>
        <div id="myDIV">
            <button class="btn" id="option1" value="option1">option1</button>
            <button class="btn active" id="option2" value="option2">option2</button>
            <button class="btn" id="option3" value="option3">option3</button>
            <button class="btn" id="option4" value="option4">option4</button>
        </div>
        <br><br>
        <button onclick="myFunction()">Submit</button>
        <button onclick="log()">Logout</button>
    </form>
    <script src="./multiques.js"></script>
    <p id="demo"></p>
    <p id="demo1"></p>
    <script type="text/javascript">
        //window.onbeforeunload = function () {
        //    return 'Are you really want to perform the action?';
        //}
        //window.onbeforeunload = function (event) {
        //    event.returnValue = "Write something clever here..";
        //};

        var url_string = window.location.href
        var url = new URL(url_string);
        var username = url.searchParams.get("name");
        //console.log(username)
        //const params = new URLSearchParams(window.location.search)
        //let username = "sam1";

        document.getElementById("demo1").innerHTML = username;
        var user = localStorage.setItem("firstname", username);
        if (username == null) {
            window.location.href = "/login";
        }
        //sessionStorage.setItem("username", username);
        var header = document.getElementById("myDIV");
        var btns = header.getElementsByClassName("btn");
        for (var i = 0; i < btns.length; i++) {
            btns[i].addEventListener("click", function () {
                //this.className += " active";
                var current = document.getElementsByClassName("active");
                current[0].className = current[0].className.replace("active", "");
                this.className += " active";
            });
        }
        var selected;
        function myFunction() {
            //console.log(document.getElementsByClassName("active")[0].value)
            selected = document.getElementsByClassName("active")[0].value;
            //let questionno = 1;
            //var selected = document.getElementsByClassName("active")[0].value;
            //if (selected == "Blue") {
            //    console.log("correct answer");
            //}
            //else {
            //    console.log("incorrect answer");
            //}
            function1(selected);
        }
        function log() {
            fetch('http://localhost:3000/logout', {
                method: 'GET',
                body: JSON.stringify(),
                headers: {
                    'Content-type': 'application/json; charset=UTF-8'
                }
            })
            window.location.href = "/register"
        }
        function questions() {
            time();
            const nam = { "username": username }
            fetch('http://localhost:3000/quesone', {
                method: 'POST',
                body: JSON.stringify(nam),
                redirect: 'follow',
                headers: {
                    'Content-type': 'application/json; charset=UTF-8'
                }
            })
                .then(response => response.json())
                .then(json => {
                    if (json.ref == "blue") {
                        window.location.href = "/HTMLPage1.html";
                    }
                    else {
                        //console.log(json.question.qb);
                        quiz(json);
                        username;
                        one = json.question.questionno;
                        two = json.question.qb;
                    }
                }).catch(error => {
                    console.log(error)
                    window.location.href = "/register"
                })
        }
        function random() {
            return 'stop'
        }
        //window.onbeforeunload = random;
        function quiz(json) {
                    console.log(json.question.question)
                    document.getElementById("question").innerHTML = json.question.question;
                    document.getElementById("option1").innerHTML = json.question.option1;
                    document.getElementById("option2").innerHTML = json.question.option2;
                    document.getElementById("option3").innerHTML = json.question.option3;
                    document.getElementById("option4").innerHTML = json.question.option4;
                }
        //window.onload = question();
        function time() {
                    //var timer;
                    var sec = 56;
                    timer = setInterval(() => {
                        document.getElementById('demo').innerHTML = 'Time: 00:' + sec;
                        if (sec < 10) {
                            //console.log(sec)
                            document.getElementById('demo').innerHTML = 'Time: 00:0' + sec;
                        }
                        sec--;
                        if (sec < 0) {
                            clearInterval(timer);
                            console.log("timeup");
                            questions();
                            selected = document.getElementsByClassName("active")[0].value;
                            function1(selected);
                        }
                    }, 1000);
        }
        
    </script>
</body>
</html>